<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | THE SCENERY VINTAGE FARM</title>
<style>
*{box-sizing:border-box}
body{margin:0;background:#f0f1f3;font-family:Segoe UI,Tahoma,sans-serif;color:#222}
.page{max-width:1800px;margin:32px auto;background:#fff;padding:32px 36px;border-radius:16px}
.header{display:flex;justify-content:space-between;align-items:flex-end;border-bottom:1px solid #d6d9de;padding-bottom:16px}
.header-left h1{margin:0;font-size:28px}
.header-left h2{margin:4px 0 0;font-size:16px;color:#666}
.header-right{display:flex;gap:20px}
label{font-size:13px;font-weight:600;color:#555}
input,textarea{width:100%;padding:8px 10px;border:1px solid #d1d5db;border-radius:10px;font-size:13px}
.card{margin-top:24px;background:#fafafa;padding:20px;border-radius:16px}
table{width:100%;border-collapse:collapse;font-size:13px}
th{background:#2f2f2f;color:#fff;padding:10px}
td{padding:8px;border-bottom:1px solid #e5e7eb;vertical-align:top}
.btn{padding:10px 22px;border-radius:12px;font-weight:600;border:none;cursor:pointer}
.btn.add{background:#e6e8ec}
.btn-del{background:#fee2e2;border:none;border-radius:8px;padding:6px 10px;cursor:pointer}
.actions{margin-top:24px;display:flex;justify-content:flex-end;align-items:center;gap:16px}
.img-box{width:120px;height:120px;border:2px dashed #94a3b8;border-radius:12px;display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;background:#fff}
.img-box img{width:100%;height:100%;object-fit:cover}
.img-hint{font-size:13px;color:#64748b}

/* modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000}
.modal-box{background:#fff;padding:24px;border-radius:16px;width:340px;text-align:center}
.modal-actions{display:flex;justify-content:center;gap:12px;margin-top:16px}
.modal .danger{background:#dc2626;color:#fff}
.modal .ghost{background:#e5e7eb}

@media print{
  button,.btn-del{display:none!important}
}
</style>
</head>
<body>

<div class="page">
  <div class="header">
    <div class="header-left">
      <h1>‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
      <h2>THE SCENERY VINTAGE FARM</h2>
    </div>
    <div class="header-right">
      <div>
        <label>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
        <input type="month" id="monthPicker">
      </div>
      <div>
        <label>‡πÅ‡∏ú‡∏ô‡∏Å</label>
        <input type="text" id="deptInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏£‡∏±‡∏ß / ‡∏ä‡πà‡∏≤‡∏á / ‡∏™‡πÇ‡∏ï‡∏£‡πå">
      </div>
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>#</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th>‡∏£‡∏π‡∏õ</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
          <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
          <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th><th>‡∏£‡∏ß‡∏°</th><th>‡∏£‡πâ‡∏≤‡∏ô</th><th>‡∏•‡∏ö</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <button class="btn add" onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    <button class="btn add" onclick="openCopyModal()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
  </div>

  <div class="actions">
    <strong>‡∏£‡∏ß‡∏° <span id="grand">0.00</span> ‡∏ö‡∏≤‡∏ó</strong>
    <button class="btn" onclick="window.print()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå / Save PDF</button>
  </div>
</div>

<!-- Delete confirmation modal -->
<div class="modal" id="deleteModal">
  <div class="modal-box">
    <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
    <p>‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeDelete()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn danger" onclick="confirmDelete()">‡∏•‡∏ö</button>
    </div>
  </div>
</div>

<!-- Copy month modal -->
<div class="modal" id="copyModal">
  <div class="modal-box">
    <h3>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
    <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤</p>
    <input type="month" id="copyFrom" style="margin-top:12px">
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeCopy()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn add" onclick="confirmCopy()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
    </div>
  </div>
</div>

<script>
const monthInput=document.getElementById('monthPicker');
const deptInput=document.getElementById('deptInput');
const tbody=document.getElementById('tbody');
let deleteTarget=null;

monthInput.addEventListener('change',loadMonth);
deptInput.addEventListener('input',saveMonth);

function addRow(d={}){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td class="no"></td>
    <td><textarea>${d.desc||''}</textarea></td>
    <td>
      <div class="img-box">
        ${d.img?`<img src="${d.img}">`:'<span class="img-hint">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ</span>'}
        <input type="file" hidden>
      </div>
    </td>
    <td><input value="${d.unit||''}"></td>
    <td><input type="number" value="${d.stock||''}"></td>
    <td><input type="number" value="${d.remain||''}"></td>
    <td><input type="number" class="buy" value="${d.buy||0}"></td>
    <td><input type="number" class="price" value="${d.price||0}"></td>
    <td class="sum">0.00</td>
    <td><input value="${d.vendor||''}"></td>
    <td><button class="btn-del" onclick="askDelete(this)">üóë</button></td>
  `;
  tbody.appendChild(tr);
  bindRow(tr);
  renumber(); calcAll(); saveMonth();
}

function bindRow(tr){
  tr.querySelectorAll('input,textarea').forEach(el=>{
    el.addEventListener('input',()=>{calcAll();saveMonth();});
  });
  const box=tr.querySelector('.img-box');
  const f=box.querySelector('input');
  box.onclick=()=>f.click();
  f.onchange=()=>{
    const r=new FileReader();
    r.onload=()=>{
      box.innerHTML=`<img src="${r.result}"><input type="file" hidden>`;
      bindRow(tr); saveMonth();
    }
    r.readAsDataURL(f.files[0]);
  };
}

function askDelete(btn){
  deleteTarget=btn.closest('tr');
  document.getElementById('deleteModal').style.display='flex';
}
function closeDelete(){
  document.getElementById('deleteModal').style.display='none';
}
function confirmDelete(){
  if(deleteTarget){
    deleteTarget.remove();
    deleteTarget=null;
    renumber(); calcAll(); saveMonth();
  }
  closeDelete();
}

function calcAll(){
  let g=0;
  tbody.querySelectorAll('tr').forEach(tr=>{
    const q=tr.querySelector('.buy').value||0;
    const p=tr.querySelector('.price').value||0;
    const s=(q*p).toFixed(2);
    tr.querySelector('.sum').innerText=s;
    g+=parseFloat(s);
  });
  document.getElementById('grand').innerText=g.toFixed(2);
}

function renumber(){
  document.querySelectorAll('.no').forEach((n,i)=>n.innerText=i+1);
}

function saveMonth(){
  if(!monthInput.value) return;
  const rows=[];
  tbody.querySelectorAll('tr').forEach(tr=>{
    rows.push({
      desc:tr.querySelector('textarea').value,
      img:tr.querySelector('img')?.src||'',
      unit:tr.children[3].querySelector('input').value,
      stock:tr.children[4].querySelector('input').value,
      remain:tr.children[5].querySelector('input').value,
      buy:tr.children[6].querySelector('input').value,
      price:tr.children[7].querySelector('input').value,
      vendor:tr.children[9].querySelector('input').value
    });
  });
  const payload={
    dept:deptInput.value,
    rows
  };
  localStorage.setItem('PO_'+monthInput.value,JSON.stringify(payload));
}

function loadMonth(){
  tbody.innerHTML='';
  const raw=localStorage.getItem('PO_'+monthInput.value);
  if(!raw){
    deptInput.value='';
    addRow();
    return;
  }
  const data=JSON.parse(raw);
  deptInput.value=data.dept||'';
  data.rows.forEach(r=>addRow(r));
}

function openCopyModal(){
  if(!monthInput.value) return alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
  const d=new Date(monthInput.value+'-01');
  d.setMonth(d.getMonth()-1);
  document.getElementById('copyFrom').value=d.toISOString().slice(0,7);
  document.getElementById('copyModal').style.display='flex';
}
function closeCopy(){
  document.getElementById('copyModal').style.display='none';
}
function confirmCopy(){
  const from=document.getElementById('copyFrom').value;
  if(!from) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô');
  const raw=localStorage.getItem('PO_'+from);
  if(!raw) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å');
  localStorage.setItem('PO_'+monthInput.value,raw);
  closeCopy(); loadMonth();
}

addRow();
</script>

</body>
</html>
