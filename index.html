<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | THE SCENERY VINTAGE FARM</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#f0f1f3;
  font-family:Segoe UI,Tahoma,sans-serif;
  color:#222
}
.page{
  max-width:1800px;
  margin:32px auto;
  background:#fff;
  padding:32px 36px;
  border-radius:16px
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  border-bottom:1px solid #d6d9de;
  padding-bottom:16px
}
.header-left h1{margin:0;font-size:28px}
.header-left h2{margin:4px 0 0;font-size:16px;color:#666}
.header-right{display:flex;gap:20px}
label{font-size:13px;font-weight:600;color:#555}
input,textarea{
  width:100%;
  padding:8px 10px;
  border:1px solid #d1d5db;
  border-radius:10px;
  font-size:13px
}
.card{
  margin-top:24px;
  background:#fafafa;
  padding:20px;
  border-radius:16px
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px
}
th{
  background:#2f2f2f;
  color:#fff;
  padding:10px
}
td{
  padding:8px;
  border-bottom:1px solid #e5e7eb;
  vertical-align:top
}
.sub-row td{
  background:#f9fafb;
  padding:12px
}
.sub-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px
}
.btn{
  padding:10px 22px;
  border-radius:12px;
  font-weight:600;
  border:none;
  cursor:pointer
}
.btn.add{background:#e6e8ec}
.btn-print{
  margin-left:16px;
  background:#111;
  color:#fff;
  padding:8px 16px;
  border-radius:10px
}
.actions{
  margin-top:32px;
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:16px
}
.btn-del{
  background:#fee2e2;
  border:none;
  border-radius:8px;
  padding:6px 10px;
  cursor:pointer
}
.img-box{
  width:180px;
  height:180px;
  border:2px dashed #94a3b8;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  overflow:hidden;
  background:#fff;
}
.img-box img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.img-hint{
  font-size:13px;
  color:#64748b;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  backdrop-filter:blur(3px);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000
}
.modal-box{
  background:#fff;
  padding:24px;
  border-radius:16px;
  width:320px;
  text-align:center
}
.trash-big{
  font-size:48px;
  color:#dc2626;
  margin-bottom:8px
}
@media print{
  button,.btn-del,.btn-print{display:none!important}
}
</style>
</head>
<body>

<div class="page">
  <div class="header">
    <div class="header-left">
      <h1>‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
      <h2>THE SCENERY VINTAGE FARM</h2>
    </div>
    <div class="header-right">
      <div>
        <label>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
        <input type="month" id="monthPicker">
      </div>
      <div>
        <label>‡πÅ‡∏ú‡∏ô‡∏Å</label>
        <input type="text">
      </div>
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
          <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
          <th>‡∏£‡∏π‡∏õ</th>
          <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
          <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å</th>
          <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
          <th>‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
          <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
          <th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
          <th>‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</th>
          <th>‡∏•‡∏ö</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <button class="btn add" onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
    <button class="btn add" onclick="copyWithPrompt()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
  </div>

  <div class="actions">
    <strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô <span id="grand">0.00</span> ‡∏ö‡∏≤‡∏ó</strong>
    <button class="btn-print" onclick="printPDF()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå / Save PDF</button>
  </div>
</div>

<div class="modal" id="copyModal">
  <div class="modal-box">
    <h3>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
    <label>‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
    <input type="month" id="copyFrom">
    <label>‡πÑ‡∏õ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
    <input type="month" id="copyTo">
    <div class="modal-actions">
      <button class="btn" onclick="closeCopy()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn add" onclick="confirmCopy()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
    </div>
  </div>
</div>

<div class="modal" id="deleteModal">
  <div class="modal-box">
    <div class="trash-big">üóë</div>
    <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
    <p>‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>
    <div class="modal-actions">
      <button class="btn" onclick="closeDelete()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn add" onclick="confirmDelete()">‡∏•‡∏ö</button>
    </div>
  </div>
</div>

<script>
const monthInput=document.getElementById('monthPicker');
const tbody=document.getElementById('tbody');
let deleteTarget=null;

monthInput.addEventListener('change',loadMonth);

function addRow(){
  const i=tbody.children.length/2+1;
  const main=document.createElement('tr');
  main.innerHTML=`
    <td class="no">${i}</td>
    <td><textarea></textarea></td>
    <td>
      <div class="img-box" onclick="pickImage(this)">
        <span class="img-hint">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ</span>
        <input type="file" accept="image/*" hidden onchange="previewImage(this)">
      </div>
    </td>
    <td><input></td>
    <td><input type="number"></td>
    <td><input type="number"></td>
    <td><input type="number" class="buy" oninput="calc(this)"></td>
    <td><input type="number" class="price" oninput="calc(this)"></td>
    <td class="sum">0.00</td>
    <td><input></td>
    <td><button class="btn-del" onclick="askDelete(this)">üóë</button></td>
  `;
  const sub=document.createElement('tr');
  sub.className='sub-row';
  sub.innerHTML=`
    <td colspan="11">
      <div class="sub-grid">
        <div><label>‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label><textarea></textarea></div>
        <div><label>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label><textarea></textarea></div>
      </div>
    </td>
  `;
  tbody.append(main,sub);
  saveMonth();
}

function pickImage(box){
  box.querySelector('input[type=file]').click();
}

function previewImage(input){
  const file=input.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    const box=input.closest('.img-box');
    box.innerHTML=`<img src="${reader.result}">`;
    box.appendChild(input);
    saveMonth();
  };
  reader.readAsDataURL(file);
}

function calc(el){
  const r=el.closest('tr');
  const q=r.querySelector('.buy').value||0;
  const p=r.querySelector('.price').value||0;
  r.querySelector('.sum').innerText=(q*p).toFixed(2);
  recalcGrand();
}

function recalcGrand(){
  let t=0;
  document.querySelectorAll('.sum').forEach(s=>t+=parseFloat(s.innerText||0));
  document.getElementById('grand').innerText=t.toFixed(2);
}

function askDelete(btn){
  deleteTarget=btn;
  document.getElementById('deleteModal').style.display='flex';
}
function closeDelete(){
  document.getElementById('deleteModal').style.display='none';
}
function confirmDelete(){
  const tr=deleteTarget.closest('tr');
  tr.nextElementSibling.remove();
  tr.remove();
  closeDelete();
  renumber(); recalcGrand(); saveMonth();
}
function renumber(){
  document.querySelectorAll('.no').forEach((n,i)=>n.innerText=i+1);
}
function saveMonth(){
  if(!monthInput.value) return;
  const data=[];
  document.querySelectorAll('#tbody tr').forEach(tr=>{
    if(!tr.classList.contains('sub-row')){
      data.push({main:tr.innerHTML,sub:tr.nextElementSibling.innerHTML});
    }
  });
  localStorage.setItem('PO_'+monthInput.value,JSON.stringify(data));
}
function loadMonth(){
  const raw=localStorage.getItem('PO_'+monthInput.value);
  tbody.innerHTML='';
  if(!raw){addRow();return;}
  JSON.parse(raw).forEach(d=>{
    const m=document.createElement('tr'); m.innerHTML=d.main;
    const s=document.createElement('tr'); s.className='sub-row'; s.innerHTML=d.sub;
    tbody.append(m,s);
  });
  recalcGrand();
}
function copyWithPrompt(){
  document.getElementById('copyModal').style.display='flex';
  document.getElementById('copyTo').value=monthInput.value;
}
function closeCopy(){
  document.getElementById('copyModal').style.display='none';
}
function confirmCopy(){
  const from=document.getElementById('copyFrom').value;
  const to=document.getElementById('copyTo').value;
  const f=new Date(from+'-01');
  const t=new Date(to+'-01');
  f.setMonth(f.getMonth()+1);
  if(f.getTime()!==t.getTime()) return alert('‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
  const raw=localStorage.getItem('PO_'+from);
  if(!raw) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
  localStorage.setItem('PO_'+to,raw);
  closeCopy(); loadMonth();
}
function printPDF(){ window.print(); }
addRow();
</script>

</body>
</html>
