<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | THE SCENERY VINTAGE FARM</title>
<style>
*{box-sizing:border-box}
body{margin:0;background:#f0f1f3;font-family:Segoe UI,Tahoma,sans-serif;color:#222}
.page{max-width:1800px;margin:32px auto;background:#fff;padding:32px 36px;border-radius:16px}
.header{display:flex;justify-content:space-between;align-items:flex-end;border-bottom:1px solid #d6d9de;padding-bottom:16px}
.header-left h1{margin:0;font-size:28px}
.header-left h2{margin:4px 0 0;font-size:16px;color:#666}
.header-right{display:flex;gap:20px}
label{font-size:13px;font-weight:600;color:#555}
input,textarea{width:100%;padding:8px 10px;border:1px solid #d1d5db;border-radius:10px;font-size:13px}
.card{margin-top:24px;background:#fafafa;padding:20px;border-radius:16px}
table{width:100%;border-collapse:collapse;font-size:13px}
th{background:#2f2f2f;color:#fff;padding:10px}
td{padding:8px;border-bottom:1px solid #e5e7eb;vertical-align:top}
.sub-row td{background:#f9fafb;padding:12px}
.sub-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.btn{padding:10px 22px;border-radius:12px;font-weight:600;border:none;cursor:pointer}
.btn.add{background:#e6e8ec}
.btn-print{margin-left:16px;background:#111;color:#fff;padding:8px 16px;border-radius:10px}
.actions{margin-top:32px;display:flex;justify-content:flex-end;align-items:center;gap:16px}
.btn-del{background:#fee2e2;border:none;border-radius:8px;padding:6px 10px;cursor:pointer}
.img-box{width:180px;height:180px;border:2px dashed #94a3b8;border-radius:16px;display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;background:#fff}
.img-box img{width:100%;height:100%;object-fit:cover}
.img-hint{font-size:13px;color:#64748b}
@media print{button,.btn-del,.btn-print{display:none!important}}
</style>
</head>
<body>

<div class="page">
  <div class="header">
    <div class="header-left">
      <h1>‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
      <h2>THE SCENERY VINTAGE FARM</h2>
    </div>
    <div class="header-right">
      <div>
        <label>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
        <input type="month" id="monthPicker">
      </div>
      <div>
        <label>‡πÅ‡∏ú‡∏ô‡∏Å</label>
        <input type="text" id="dept">
      </div>
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th><th>‡∏£‡∏π‡∏õ</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
          <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
          <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th><th>‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</th><th>‡∏•‡∏ö</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
    <button class="btn add" onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
  </div>

  <div class="actions">
    <strong>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô <span id="grand">0.00</span> ‡∏ö‡∏≤‡∏ó</strong>
    <button class="btn-print" onclick="window.print()">üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå / Save PDF</button>
  </div>
</div>

<script>
const monthInput = document.getElementById('monthPicker');
const tbody = document.getElementById('tbody');

monthInput.addEventListener('change', loadMonth);

function addRow(data={}){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td class="no"></td>
    <td><textarea>${data.desc||''}</textarea></td>
    <td>
      <div class="img-box">
        ${data.img ? `<img src="${data.img}">` : '<span class="img-hint">‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ</span>'}
        <input type="file" accept="image/*" hidden>
      </div>
    </td>
    <td><input value="${data.unit||''}"></td>
    <td><input type="number" value="${data.stock||''}"></td>
    <td><input type="number" value="${data.remain||''}"></td>
    <td><input type="number" class="buy" value="${data.buy||0}"></td>
    <td><input type="number" class="price" value="${data.price||0}"></td>
    <td class="sum">0.00</td>
    <td><input value="${data.vendor||''}"></td>
    <td><button class="btn-del" onclick="this.closest('tr').remove();saveMonth()">üóë</button></td>
  `;
  tbody.appendChild(tr);
  renumber();
  calcRow(tr);
  bindRow(tr);
  saveMonth();
}

function bindRow(tr){
  tr.querySelectorAll('input,textarea').forEach(el=>{
    el.addEventListener('input', saveMonth);
  });
  const box=tr.querySelector('.img-box');
  const fileInput=box.querySelector('input[type=file]');
  box.onclick=()=>fileInput.click();
  fileInput.onchange=()=>{
    const r=new FileReader();
    r.onload=()=>{box.innerHTML=`<img src="${r.result}"><input type="file" hidden>`;bindRow(tr);saveMonth();}
    r.readAsDataURL(fileInput.files[0]);
  }
}

function calcRow(tr){
  const q=tr.querySelector('.buy').value||0;
  const p=tr.querySelector('.price').value||0;
  tr.querySelector('.sum').innerText=(q*p).toFixed(2);
  recalc();
}

function recalc(){
  let t=0;
  document.querySelectorAll('.sum').forEach(s=>t+=parseFloat(s.innerText));
  document.getElementById('grand').innerText=t.toFixed(2);
}

function renumber(){
  document.querySelectorAll('.no').forEach((n,i)=>n.innerText=i+1);
}

function saveMonth(){
  if(!monthInput.value) return;
  const rows=[];
  tbody.querySelectorAll('tr').forEach(tr=>{
    rows.push({
      desc:tr.querySelector('textarea').value,
      img:tr.querySelector('img')?.src||'',
      unit:tr.children[3].querySelector('input').value,
      stock:tr.children[4].querySelector('input').value,
      remain:tr.children[5].querySelector('input').value,
      buy:tr.children[6].querySelector('input').value,
      price:tr.children[7].querySelector('input').value,
      vendor:tr.children[9].querySelector('input').value
    });
    calcRow(tr);
  });
  localStorage.setItem('PO_'+monthInput.value, JSON.stringify(rows));
}

function loadMonth(){
  tbody.innerHTML='';
  const raw=localStorage.getItem('PO_'+monthInput.value);
  if(!raw){addRow();return;}
  JSON.parse(raw).forEach(r=>addRow(r));
}

addRow();
</script>
</body>
</html>
